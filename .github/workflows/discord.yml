name: CI/CD y NotificaciÃ³n a Discord

on:
  push:
    branches:
      - main 
  pull_request:
    branches:
      - main 
  workflow_dispatch:
    
jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout del cÃ³digo
        uses: actions/checkout@v4
      
      # ----------------------------------------------------------------
      # PASO CLAVE: NotificaciÃ³n de Discord (Un solo paso)
      - name: NotificaciÃ³n de estado a Discord
        if: always() 
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }} 
          status: ${{ job.status }}
          title: "Estado del Despliegue de PROYECTO-DE-ESPECIALIDAD"
          
          description: |
            âœ… **Flujo Finalizado: ${{ job.status }}**
            
            ðŸ‘¤ **Autor:** ${{ github.actor }}
            ðŸ“ **Mensaje del commit / PR:**
            > ${{ github.event.head_commit.message || github.event.pull_request.title || 'N/A' }}
            
            ðŸ”— **Ver commit/PR:** ${{ github.event.pull_request.html_url || format('https://github.com/{0}/commit/{1}', github.repository, github.sha) }}
            
          url: "https://github.com/${{ github.repository }}"
          username: "GitHub CI/CD Bot"
          color: ${{ job.status == 'success' && '0x00ff00' || '0xff0000' }}

          # AÃ‘ADIR IMAGEN USANDO SU URL PÃšBLICA DE GITHUB
          # Esta URL estÃ¡ construida usando la URL Raw de GitHub.
          # Debes reemplazar [TU-REPOSITORIO-COMPLETO] con el nombre de tu repo (ej. WhiteMooncy/PROYECTO-DE-ESPECIALIDAD)
          image: "https://raw.githubusercontent.com/PROYECTO-DE-ESPECIALIDAD/blob/main/assets/sources/img/vegetta.pngg"

          content: "El flujo de trabajo CI/CD ha finalizado con el estado: **${{ job.status }}**."
