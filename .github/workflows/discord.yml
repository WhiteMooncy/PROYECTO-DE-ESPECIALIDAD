name: CI/CD y Notificación a Discord

on:
  push:
    branches:
      - main 
  pull_request:
    branches:
      - main 
  workflow_dispatch: # Permite ejecutar manualmente desde GitHub

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout del código
        uses: actions/checkout@v4
      
      - name: Notificación de estado a Discord
        # El 'if: always()' asegura que se notifique el estado, incluso si falla el paso anterior
        if: always() 
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }} 
          
          status: ${{ job.status }}
          title: "Despliegue de PROYECTO-DE-ESPECIALIDAD"
          description: "Revisión de la rama ${{ github.ref_name }} | Evento: ${{ github.event_name }}"
          url: "https://github.com/${{ github.repository }}"
          username: "GitHub Actions BOT"

          color: 0x00ff00 # Color Verde (Éxito)
          
          # content: ${{ secrets.MENTION_ID && format('Hey <@{}>, el flujo de trabajo ha finalizado.', secrets.MENTION_ID) }}